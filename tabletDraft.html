<!Doctype html>
<head>
	<style>
		body {
			padding: 20px 0 0 20px;
		}
		button {
			margin-bottom: 30px;
		}
		.messages {
			text-align: center;
			padding: 20px 0px 0px 20px;
		}
		#speed {
			width: 20em;
		}
		#centered {
			display: inline-block;
			width: 75%;
			border-bottom: 2px solid #000000;
			border-top: 2px solid #000000;
		}
		.page {
			border-bottom: 2px solid #000000;
			border-top: 2px solid #000000;
			padding: 20px 20px 20px 20px;
		}
		.section {
			border-bottom: 0.5px solid #000000;
			border-top: 0.5px solid #000000;
			padding: 20px 20px 20px 20px;
		}
		.article {

		}
	</style>
	<script
  src="http://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
  crossorigin="anonymous"></script>
</head>


<body>

<!--All <p> in articles are sentences-->
<div class="article messages" id="article1">
</div>
	

	<script type="text/javascript">


///////////////////////////////////////////////////////////////////////////
 		pageIndex = 0;
 		sectionIndex = 0;
 		sentenceIndex = 0;
 		sentenceTotal = 0;

 		//skip forwards and backwards using keycodes for 'd' & 'a'
 		$("body").on("keypress", function(evt) {
 			console.log(evt.which);
 			if(evt.which == 100) {
 				console.log("forward");
 				forwardSentence();
 			} 
 			if(evt.which == 119) {
 				console.log("nextsection")
 				forwardSection();
 			}
 			if(evt.which == 113) {
 				console.log("nextPage");
 				forwardPage();
 			}
 			if (evt.which == 97) {
 				console.log("backwards");
 				if(sentenceIndex <= contents.length) {
 					sectionIndex--;
 					sentenceIndex=sentenceIndex.length-1;
 					readTest(contents[pageIndex][sectionIndex][sentenceIndex]);
 				}
 				else {
 					readTest(contents[pageIndex][sectionIndex][sentenceIndex]);
 				}
 				sentenceIndex--;
 				console.log(contents);
 			}
 		})

 		function forwardSentence() {
 			console.log("sentence called")
 			if(sentenceIndex >= contents[pageIndex][sectionIndex].length){
 				forwardSection();
 			} else {
 			readTest(contents[pageIndex][sectionIndex][sentenceIndex]);
 			sentenceIndex++;
 		}
 		}

 		function forwardSection(){
 			console.log("section called")
 			sectionIndex++;
 				sentenceIndex=0;
 			if(sectionIndex >= contents[pageIndex].length) {
 				forwardPage();
 			} else {
 				readTest(contents[pageIndex][sectionIndex][sentenceIndex]);
 				sentenceIndex++;
 			}
 		}

 		function forwardPage() {
 			console.log("page called")
 			pageIndex++;
 			sectionIndex=0;
 			sentenceIndex=0;
 			if(pageIndex >= contents.length) {
 				pageIndex=0;
 				readTest(contents[pageIndex][sectionIndex][sentenceIndex]);
 				sentenceIndex++;
 			} else {
 			readTest(contents[pageIndex][sectionIndex][sentenceIndex]);
 			sentenceIndex++;
 			}
 		}

 		function backwards(){
 		}

 		contents = [
 		  [
 		    [
 		      'The Activity and Art of Reading. ',
 		      'This is a book for readers and for those who wish to become readers. ',
 		      'Particularly, it is for readers of books. ',
 		      'Even more particularly, it is for those whose main purpose in reading books is to gain increased understanding. '
 		    ],
 		    [
 		      'By readers we mean people who are still accustomed, as almost every literate and intelligent person used to be, to gain a large share of their information about and their understanding of the world from the written word. '
 		    ]
 		  ],
 		  [
 		    [
 		      'Not all of it, of course; even in the days before radio and television, a certain amount of information and understanding was acquired through spoken words and through observation. ',
 		      'But for intelligent and curious people that was never enough. ',
 		      'They knew that they had to read too, and they did read. '
 		    ]
 		  ]
 		]

 		articleEle = $('.article')

 		// each page
 		for(var i = 0; i < contents.length; i++) {
 			pageEle = $("<div class='page' id='page" + i + "'/>")
 			articleEle.append(pageEle);
 			// each section
 			for(var j = 0; j < contents[i].length; j++) {
 				sectionEle = $("<div class='section' id='section" + j + "'/>")
 				pageEle.append(sectionEle);
 				// each sentence
 				for (var k = 0; k < contents[i][j].length; k++) {
 					sentenceEle = $("<span class='sentence' id='sentence" + k + "'>" + contents[i][j][k] + "</span>")
 					sectionEle.append(sentenceEle);
 					console.log(i+1,j+1,k+1,sentenceTotal);
 					sentenceTotal++;
 				}
 			}
 		}

 		function readTest(text){
			speech = new SpeechSynthesisUtterance(text);
			window.speechSynthesis.speak(speech);
			window.speechSynthesis.resume();
		}

		
		/*
		var res = emailBody.slice(0,0);
		var msg;

		function readMyEmail(targetEmail){
			emailBody = document.getElementById(targetEmail).innerText;
			for (i=0 ; i<emailBody.length; i++){
				if ((emailBody[i] =='.' || emailBody[i] == '?') && !isNumeric(emailBody[i+1]) ){
					period.push(i);
				}
			}
			read(emailBody);
		}

		function read(text){
			msg = new SpeechSynthesisUtterance(text);
			msg.rate = speed;
			window.speechSynthesis.speak(msg);
			window.speechSynthesis.resume();
			msg.onboundary = function(event) {
			    var length = text.length;
			    var index = event.charIndex;
			    var chr = text.charAt(index);
			    // subtract index2 first because then the current indexvalue would be added twice.  
			   	index3 = index3 - index2 + index;
			   	index2 = index;
			    if (index3 > period[periodIndex]) {
			    	periodIndex = periodIndex + 1;
			    } 
				res = text.slice(index, length);
			};
		}

		function readMyEmailSTOP(targetEmail){
			window.speechSynthesis.cancel();
			location.reload();
		}*/
		
		
		//SPEED
		// changeSpeed()
		// 		- changes the rate of TTS on the spot, using information from the slider
		// 		Uses variables
		// 			- index2, index3
		// 		Parameter
		// 			-  "NewWavlue" is the numeric value taken the slider
		// 		Logic
		//			- changeSpeed is called when the slider is used, changeSpeed then takes the 
		// 			number that the slider was changed to, stops the text from reading, changes 
		// 			the speed, and starts reading the text again
		// 		Returns 
		// 			- the text with a new reading rate



	</script>

</body>
</html>
